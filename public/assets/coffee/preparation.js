// Generated by CoffeeScript 1.8.0
var __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

$(function() {
  var hostname, port, protocol, schema, sock, url;
  hostname = location.hostname;
  port = location.port;
  protocol = location.protocol;
  schema = protocol === 'https:' ? 'wss:' : 'ws:';
  url = "" + schema + "//" + hostname + ":" + port + "/socket";
  sock = new ReconnectingWebSocket(url, null, {
    debug: false
  });
  sock.onopen = function(e) {
    sock.send('/subscribe order');
    return sock.send('/subscribe user');
  };
  sock.onmessage = function(e) {
    var data, range, sender, _ref, _ref1;
    data = JSON.parse(e.data);
    sender = data.sender;
    range = [20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30];
    range.unshift(17);
    if (sender === 'order' && (_ref = parseInt(data.from), __indexOf.call(range, _ref) >= 0) || (_ref1 = parseInt(data.to), __indexOf.call(range, _ref1) >= 0)) {
      return location.reload();
    } else if (sender === 'user') {
      return location.reload();
    }
  };
  sock.onerror = function(e) {
    return location.reload();
  };
  return $("abbr.timeago").timeago();
});
